

#chat-history { 
    flex: 1; 
    overflow-y: auto; 
    padding: 80px 20px 0 20px; 
    padding-bottom: 140px; /* Space for input */
    display: flex; 
    flex-direction: column; 
    gap: 24px; /* Increased gap for breathing room */
    scroll-behavior: smooth;
}

#chat-history::-webkit-scrollbar { width: 6px; }
#chat-history::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }

/* Base Message Style */
.msg { 
    position: relative; 
    word-wrap: break-word; 
    line-height: 1.6; 
    font-size: 15px;
    color: var(--text-primary);
    animation: fadeIn 0.3s cubic-bezier(0.2, 0, 0, 1) forwards;
    opacity: 0;
    transform: translateY(10px);
}

@keyframes fadeIn {
    to { opacity: 1; transform: translateY(0); }
}

/* --- User Message (Bubble) --- */
.msg.user { 
    align-self: flex-end; 
    background: var(--bg-user-msg);
    color: var(--text-user-msg);
    padding: 12px 20px; 
    border-radius: 24px; 
    max-width: 85%; 
    white-space: pre-wrap; 
}

.msg.user .copy-btn {
    display: none; 
}

/* --- AI Message (Clean Text) --- */
.msg.ai { 
    align-self: flex-start; 
    background: transparent; 
    width: 100%; 
    max-width: 100%;
    padding: 0 4px; /* Slight indent */
    margin: 0;
    color: var(--text-primary);
}

.msg.ai .copy-btn {
    margin-top: 8px;
    color: var(--text-tertiary);
    opacity: 0;
    transition: all 0.2s;
    float: left;
    background: var(--bg-sidebar);
    padding: 6px;
    border-radius: 8px;
}

.msg.ai:hover .copy-btn { opacity: 1; }
.msg.ai .copy-btn:hover { color: var(--primary); background: var(--btn-hover); }

/* Shared Button Styles */
.copy-btn {
    border: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* Image Styles */
.msg img { 
    max-width: 300px;
    width: 100%;
    height: auto;
    border-radius: 12px; 
    margin-bottom: 12px; 
    display: block; 
    cursor: zoom-in;
    border: 1px solid var(--border-color);
    transition: transform 0.2s;
}
.msg img:hover { transform: scale(1.01); }

/* --- Markdown Content Styling (AI) --- */

.msg.ai p { margin: 0 0 12px 0; }
.msg.ai p:last-child { margin-bottom: 0; }

/* Headings */
.msg.ai h1, .msg.ai h2, .msg.ai h3 {
    margin: 24px 0 12px 0;
    font-weight: 600;
    color: var(--text-primary);
}
.msg.ai h3 { font-size: 16px; }

/* Code Blocks */
.msg.ai pre { 
    background: var(--code-bg);
    color: var(--code-text);
    padding: 16px; 
    border-radius: 12px; 
    overflow-x: auto; 
    margin: 16px 0; 
}
.msg.ai code { 
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; 
    font-size: 0.9em; 
}
.msg.ai pre code { 
    background: none; 
    padding: 0; 
    color: var(--code-text);
}

/* Inline Code */
.msg.ai :not(pre) > code {
    background: var(--inline-code-bg);
    color: var(--text-primary);
    padding: 2px 6px;
    border-radius: 6px;
    font-size: 0.9em;
    font-weight: 500;
}

/* Lists */
.msg.ai ul, .msg.ai ol { margin: 8px 0 16px 0; padding-left: 24px; }
.msg.ai li { margin-bottom: 6px; }

/* Quotes */
.msg.ai blockquote { 
    border-left: 3px solid var(--primary); 
    margin: 16px 0; 
    padding: 4px 16px; 
    color: var(--text-secondary); 
    background: transparent;
}

/* Mobile Adjustments */
@media (max-width: 600px) {
    #chat-history {
        padding: 80px 16px 0 16px;
        padding-bottom: 120px;
    }
}